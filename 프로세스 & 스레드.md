## 프로세스 & 스레드

### CPU 코어, 멀티 프로세스, 멀티 스레드

* `CPU 코어`
  * `ALU`, `제어 장치`, `레지스터 세트` 등으로 이루어져 있다.
* `멀티 프로세서`
  * CPU 코어가 여러개
  * 여러 `프로세스`를 동시에 처리할 수 있다.
* `멀티 스레드 프로세서`
  * 한 코어 내에 여러 `레지스터 세트`가 존재한다.
  * `하드웨어적 스레드`를 `논리 프로세서`라고도 부른다.

* `멀티 스레드 (소프트웨어적 스레드)`
  * 스레드 간 프로세스의 코드, 데이터, 힙 영역은 공유된다.
  * 스레드마다 고유의 스택 영역을 가지게 되며 함수 콜 스택이나 지역변수들의 충돌을 방지한다.
  * 프로세스 자원을 공유함으로써 메모리를 더 효율적으로 사용 가능하고, 서로 간의 협력과 통신에 유리하다.
    * 다만 하나의 스레드에 문제가 생기면 다른 스레드에도 영향을 끼칠 수 있기 떄문에 프로세스 전체에 문제가 생길 수 있다는 단점이 있다.
* `멀티 프로세스`
  * fork 시 코드, 데이터, 힙, 스택 영역을 비롯한 모든 자원이 복제되어 메모리에 적재된다.
    * `쓰기 시 복사(copy on write)` 기법을 통해 메모리를 효율적으로 사용할 수도 있다.
  * exec 시에는 코드, 데이터 영역의 데이터가 새롭게 채워지고 스택 영역은 리셋된다.
  * `프로세스 간 통신(IPC: Inter-Process Communicaion)`을 통해 자원을 공유하고 데이터를 주고받을 수 있다.
* 최근 많은 OS는 CPU에 처리할 작업을 전달할 때 `프로세스`가 아닌 `스레드` 단위로 전달한다. 그리고 스레드는 실행에 필요한 최소한의 정보(프로그램 카운터를 비롯한 `레지스터`, `스택` 등)만을 유지한 채 프로세스 자원을 공유하며 실행된다.
  * 리눅스에서는 프로세스와 스레드 모두 `실행의 문맥(context of execution)`이라는 점에서 동등하다고 간주하고 이 둘을 크게 구분 짓지 않는다. 프로세스와 스레드라는 말 대신 `태스크(task)`라는 이름으로 통일하여 명명한다.

### 파이썬

* 파이썬 인터프리터는 `GIL(global interpreter lock)`을 통해 여러 스레드가 한 번에 파이썬 바이트코드를 실행하는 것을 방지하여 스레드 안전을 보장한다.
* 따라서 CPU bound 작업을 할 때 멀티 스레드를 이용하는 것은 그리 효율적이지 않다.
* 하지만, I/O bound 작업에 대해서는 GIL이 release되기 때문에, I/O 작업이 끝날 때까지 대기하는 대신 다른 스레드를 처리할 수 있다.
* 파이썬의 `코루틴(coroutine)`은 `이벤트 루프`를 통해 비동기 작업을 처리할 수 있다.
  * 코루틴을 통해 커널 모드로의 전환 없이 동시성 처리가 가능하다.

* `GIL`이 무엇인지?
  * https://it-eldorado.tistory.com/160
* GIL의 배경과 없애려는 시도
  * https://www.itworld.co.kr/news/302737